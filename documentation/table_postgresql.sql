
-- 定时任务应用配置
DROP TABLE IF EXISTS SYS_SHEDLOCK_APP;
CREATE TABLE SYS_SHEDLOCK_APP (
  APPLICATION VARCHAR(64) NOT NULL ,
  HOST_IP VARCHAR(32) not null,
  HOST_NAME varchar(100),
  STATE CHAR(1) NOT NULL DEFAULT 1,
  UPDATE_TIME TIMESTAMP(3) NOT NULL,
  PRIMARY KEY (APPLICATION,HOST_IP)
);
COMMENT ON COLUMN SYS_SHEDLOCK_APP.APPLICATION IS '当前实例应用';
COMMENT ON COLUMN SYS_SHEDLOCK_APP.HOST_IP IS '当前实例应用所属IP';
COMMENT ON COLUMN SYS_SHEDLOCK_APP.HOST_NAME IS '创建机器';
COMMENT ON COLUMN SYS_SHEDLOCK_APP.STATE IS '状态 0.关闭 1.开启';
COMMENT ON COLUMN SYS_SHEDLOCK_APP.UPDATE_TIME IS '创建及更新时间';
COMMENT ON TABLE  SYS_SHEDLOCK_APP IS '集群分佈式鎖-应用配置';

-- 定时任务锁(new)
DROP TABLE IF EXISTS SYS_SHEDLOCK_JOB;
CREATE TABLE SYS_SHEDLOCK_JOB (
  APPLICATION VARCHAR(64) NOT NULL ,
  NAME varchar(64) not null,
  HOST_IP varchar(32) not null,
  LOCKED_AT timestamp(6) NOT NULL,
  LOCK_UNTIL timestamp(6) NOT NULL,
  LOCKED_BY varchar(100) NOT NULL,
  STATE CHAR(1) NOT NULL DEFAULT 1,
  LABEL varchar(100),
  UPDATE_TIME TIMESTAMP(3) NOT NULL,
  PRIMARY KEY (APPLICATION, NAME)
);
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.APPLICATION IS '当前实例应用';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.NAME IS '任務名稱(即ID)';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.HOST_IP IS '当前实例应用所属IP';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.LOCKED_AT IS '任務開始鎖定';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.LOCK_UNTIL IS '任務鎖定至';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.LOCKED_BY IS '任務執行人';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.STATE IS '0.close关闭 1.open开启(默认) 局部限制标志位(只限制所有相同实例中的此任务)';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.LABEL IS '任務標識';
COMMENT ON COLUMN SYS_SHEDLOCK_JOB.UPDATE_TIME IS '最后更新时间(也即最近一次执行时间/获取锁时间)';
COMMENT ON TABLE  SYS_SHEDLOCK_JOB IS '集群分佈式鎖-任务配置';

/*
INSERT INTO mee_quartz.sys_shedlock_application (application,host_ip,host_name,state,create_time) VALUES
	 ('MEE_QUARTZ','10.156.122.215','SCD202212140004','1','2024-05-28 11:22:33.824'),
	 ('mee_admin','10.156.122.215','SCD202212140004','1','2024-05-28 11:22:33.824');

INSERT INTO sys_shedlock_job (application,"name",host_ip,locked_at,lock_until,locked_by,"label",state) VALUES
	 ('MEE_QUARTZ','testTask1','10.156.122.215','2024-05-28 13:18:27.823','2024-05-28 13:28:27.823','SCD202212140004',NULL,'1'),
	 ('MEE_QUARTZ','testTask2','10.156.122.215','2024-05-28 02:59:59.984','2024-05-28 03:04:59.984','SCD202212140004',NULL,'1'),
	 ('MEE_QUARTZ','testTask3','10.156.122.215','2023-09-15 01:00:00.045','2099-05-22 09:02:28.498','SCD202212140004','测试003','0');


*/

